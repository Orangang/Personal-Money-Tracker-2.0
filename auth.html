<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Подтверждение…</title>
  <meta name="robots" content="noindex" />
  <style>
    html,body{height:100%}
    body{margin:0; display:flex; align-items:center; justify-content:center;
         font:14px/1.4 -apple-system,system-ui,Segoe UI,Roboto,Inter,Arial,sans-serif; color:#111;}
  </style>
</head>
<body>
  Подтверждаем аккаунт и переходим в приложение…
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script>
    // === Конфиг ===
    const SUPABASE_URL = "https://hxbrvnwukieluzlffgyr.supabase.co";
    const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imh4YnJ2bnd1a2llbHV6bGZmZ3lyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjE0NTM1NDMsImV4cCI6MjA3NzAyOTU0M30.IWViKSutxlXo1R3DqArijjeseK6nQ9m55ZPe5EUToLQ";
    const INDEX_URL = "https://orangang.github.io/Personal-Money-Tracker-2.0/index.html";
    const AUTH_URL  = "https://orangang.github.io/Personal-Money-Tracker-2.0/auth.html";

    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
    const params = new URL(location.href).searchParams;
    const hasCode = params.has("code");

    // Попытка выйти из встроенного окна почтового клиента
    (function(){
      try{ if (window.top !== window.self) window.top.location.href = window.location.href; }catch(e){}
    })();

    (async () => {
      try{
        if (hasCode) {
          const { data, error } = await supabase.auth.exchangeCodeForSession(window.location.href);
          if (error) throw error;
          localStorage.setItem("dm_user_id", data.user.id);
          location.replace(INDEX_URL);
        } else {
          location.replace(AUTH_URL);
        }
      } catch {
        location.replace(AUTH_URL + "?err=confirm");
      }
    })();
  </script>
</body>
</html>
